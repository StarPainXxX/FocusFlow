
---

## 🧭 项目名称

**FocusFlow —— 智能专注与效率系统**

> 一款跨平台的学习 / 工作专注管理工具，整合计时、统计、同步与个性化激励系统，帮助用户以更科学的方式建立深度专注习惯。

---

## 🎯 一、项目总体目标

实现一个在 **iOS、iPadOS、macOS** 上原生运行、数据无缝同步的专注管理工具，使用 SwiftUI 构建，支持多种专注模式（普通计时、番茄模式、自定义模式），并提供可视化统计、激励机制和 iCloud 云端同步功能。

### 1.1 核心价值主张
* 帮助用户建立科学的专注习惯，提升工作学习效率
* 通过数据可视化让用户直观了解时间使用情况
* 跨设备无缝同步，随时随地保持专注状态
* 游戏化激励机制，让专注变得有趣且可持续

### 1.2 目标用户群体
* 学生群体：需要专注学习，准备考试
* 职场人士：需要深度工作，提升生产力
* 自由职业者：需要自律管理时间
* 知识工作者：需要长时间专注思考

---

## 🌍 二、Apple 生态技术方案

### 2.1 前端技术栈
* **主框架**：SwiftUI 5.0+
* **状态管理**：@State, @StateObject, @ObservableObject, @EnvironmentObject
* **并发处理**：Swift Concurrency (async/await, Actor)
* **本地数据库**：SwiftData / Core Data
* **图表库**：Swift Charts
* **动画库**：SwiftUI Animations + Lottie-ios

### 2.2 后端与云服务
* **云同步方案**：
  - 主推：iCloud (CloudKit + CloudKit Sync)
  - 备选：Firebase (Firestore + Authentication + Cloud Storage)
* **数据加密**：AES-256 端到端加密
* **CDN**：静态资源（音频、图片）使用 iCloud Drive / Firebase Storage

### 2.3 平台适配
* **iOS**：支持 iOS 17.0+
* **macOS**：支持 macOS 14.0+ (Sonoma)
* **iPadOS**：支持 iPadOS 17.0+
* **watchOS**：支持 watchOS 10.0+（可选）
* **响应式设计**：使用 SwiftUI 的自适应布局系统，支持多设备尺寸

---

## 🧩 三、核心功能模块详细设计

### 🕒 1. 专注计时器（基础模式）

#### 1.1 功能需求
* **预设时长选项**：15、25、30、45、60、90、120 分钟
* **自定义时长**：用户可输入 1-300 分钟任意时长
* **计时器类型**：
  - 倒计时模式（最常用）
  - 正计时模式（自由专注，手动结束）
  - 目标时长模式（设定目标，可超时继续）

#### 1.2 UI/UX 设计要求
* **主计时界面**：
  - 中心大号倒计时数字（分:秒格式）
  - 环形进度条（渐变色，平滑动画）
  - 剩余时间百分比显示
  - 毛玻璃效果背景
* **交互元素**：
  - 大号"开始/暂停"按钮（居中，易于点击）
  - "停止"按钮（小号，防止误触）
  - "延长时间"快捷按钮（+5min, +10min）
  - 任务标签快速选择下拉框
* **动画效果**：
  - 开始时淡入动画
  - 暂停时脉冲提示
  - 最后 1 分钟进度条变红警示
  - 完成时圆环爆炸庆祝动画

#### 1.3 功能细节
* **标签系统**：
  - 预设标签：学习、工作、阅读、编程、写作、运动等
  - 自定义标签支持颜色选择（12 色调色板）
  - 支持标签分组管理
  - 标签图标自定义（内置 50+ 图标库）
* **后台运行**：
  - iOS：使用 Background Modes 保持计时
  - macOS：缩小到菜单栏显示迷你计时器
  - 锁屏显示倒计时（iOS Live Activity）
* **声音提醒**：
  - 开始提示音（柔和钟声）
  - 暂停提示音（轻敲声）
  - 完成提示音（成就音效，可选 5 种）
  - 最后 5 分钟滴答声（可选）
  - 所有声音支持音量调节和静音

---

### 🍅 2. 番茄模式（Pomodoro）

#### 2.1 功能需求
* **标准番茄循环**：
  - 工作时段：25 分钟（可自定义 15-60 分钟）
  - 短休息：5 分钟（可自定义 3-10 分钟）
  - 长休息：15 分钟（可自定义 10-30 分钟）
  - 长休息触发：每 4 个番茄后（可自定义 2-6 个）
* **高级番茄设置**：
  - 52/17 模式（52 分钟工作 + 17 分钟休息）
  - 90 分钟超级番茄（配合人体节律）
  - 自定义多段式番茄（如 40+10+40+20）

#### 2.2 UI/UX 设计要求
* **番茄主界面**：
  - 番茄计数器（🍅🍅🍅🍅，已完成的番茄变红色）
  - 当前阶段大字显示（"专注中" / "休息中"）
  - 环形双层进度条：
    - 外环：当前番茄进度
    - 内环：整个循环进度
  - 下一阶段预告（"休息 5 分钟后开始"）
* **番茄历史视图**：
  - 今日番茄时间轴（横向滚动，显示每个番茄的时间段）
  - 番茄详情卡片（点击查看该番茄的任务备注）
  - 番茄连击数显示（连续完成的番茄数）
* **动画与反馈**：
  - 工作/休息切换时全屏过渡动画
  - 番茄成熟动画（从绿变红）
  - 完成 4 个番茄后烟花动画

#### 2.3 功能细节
* **智能番茄**：
  - 自动检测最佳专注时段（基于历史数据）
  - 番茄失败重启机制（暂停超过 3 分钟视为失败）
  - 番茄完成率追踪（成功/失败/放弃统计）
* **番茄任务绑定**：
  - 每个番茄可关联具体任务
  - 任务完成度自动更新
  - 番茄备注快速输入（语音转文字支持）
* **番茄提醒**：
  - 休息结束前 1 分钟提醒准备
  - 长休息建议活动提示（喝水、眺望、伸展）
  - 番茄间隔过长提醒（超过 2 小时未开始新番茄）

---

### ☁️ 3. 云同步与备份

#### 3.1 同步机制
* **实时同步**：
  - 完成专注会话立即上传
  - 任务修改实时同步
  - 设置变更自动同步
  - 增量同步（仅上传变更数据）
* **冲突处理**：
  - 多设备同时操作时采用"最新时间戳优先"策略
  - 冲突数据保留双版本供用户选择
  - 同步日志可查询
* **离线支持**：
  - 离线时所有功能正常使用
  - 本地数据队列缓存
  - 网络恢复后自动后台同步
  - 同步进度指示器

#### 3.2 数据备份
* **自动备份**：
  - 每日自动备份到云端（凌晨 3 点）
  - 保留最近 30 天备份记录
  - 关键数据多地域冗余存储
* **手动备份**：
  - 一键导出所有数据为加密文件
  - 备份包含：专注记录、任务、设置、成就
  - 备份文件可下载到本地或分享
* **数据恢复**：
  - 选择历史备份点恢复
  - 恢复前预览数据差异
  - 支持部分恢复（仅恢复记录/仅恢复设置）

#### 3.3 账户系统
* **登录方式**：
  - 邮箱 + 密码
  - Apple ID 登录（iOS/macOS）
  - Google 账户登录
  - 游客模式（本地存储，可后续升级）
* **账户管理**：
  - 个人资料设置（头像、昵称、简介）
  - 数据使用统计（已用存储空间）
  - 设备管理（查看已登录设备，远程登出）
  - 账户删除与数据清除

---

### 📊 4. 专注数据统计与分析

#### 4.1 统计维度
* **时间维度**：
  - 今日、昨日、本周、上周
  - 本月、上月、本年
  - 自定义日期区间
  - 全部历史数据
* **分类维度**：
  - 按标签分类统计
  - 按任务分类统计
  - 按设备分类统计
  - 按专注模式分类（普通/番茄）

#### 4.2 数据可视化组件
* **概览卡片区**（首页顶部）：
  - 今日专注时长（大号数字 + 环形图）
  - 本周累计时长（柱状图缩略）
  - 连续专注天数（火焰图标 + 数字）
  - 本周目标完成度（进度条）
* **专注趋势图**：
  - 折线图：最近 7/14/30 天每日时长
  - 柱状图：每周对比（本周 vs 上周）
  - 面积图：月度累计时长趋势
  - 雷达图：各标签时间分配
* **年度热力图**：
  - GitHub Contributions 风格
  - 颜色深度代表专注时长
  - 点击格子查看当日详情
  - 支持缩放和滚动查看全年
* **专注效率分析**：
  - 平均单次专注时长（折线图）
  - 最长专注记录（突出显示）
  - 专注时段分布（24 小时热力图）
  - 周内专注分布（周一至周日柱状图）
* **番茄专属统计**：
  - 番茄完成率趋势图
  - 平均每日完成番茄数
  - 番茄失败原因分析（暂停次数、放弃次数）
  - 最佳番茄时段推荐

#### 4.3 UI/UX 设计要求
* **统计页面布局**：
  - 顶部 Tab 切换（今日/本周/本月/全部）
  - 下拉刷新数据
  - 卡片式图表展示（间距合理，易于浏览）
  - 图表支持点击查看详情
  - 数据为空时显示友好引导
* **交互细节**：
  - 图表支持缩放和拖动
  - 长按显示精确数值
  - 支持截图分享
  - 数据异常时红色标注提示
* **性能优化**：
  - 大数据量时分页加载
  - 图表懒加载（滚动到可见区域才渲染）
  - 缓存渲染结果

#### 4.4 报告生成
* **周报内容**：
  - 本周专注总时长与目标对比
  - Top 3 专注标签
  - 最佳专注日与时段
  - 下周建议（基于数据分析）
* **月报内容**：
  - 月度专注时长趋势
  - 任务完成情况总结
  - 成就达成列表
  - 月度之星（最长专注记录）
* **年度报告**：
  - 全年专注总时长
  - 全年热力图
  - 成长曲线图
  - 年度关键词（最多使用的标签）
  - 可生成精美图片海报分享

---

### 🔔 5. 通知与提醒系统

#### 5.1 通知类型
* **专注过程通知**：
  - 专注开始确认通知
  - 专注暂停提醒
  - 专注完成庆祝通知（配动画）
  - 专注被中断警告（切换应用时）
* **定时提醒**：
  - 每日定时提醒开始专注（可设置多个时间点）
  - 长时间未专注提醒（可设置阈值，如 3 天）
  - 目标达成提醒（今日目标完成）
  - 连续专注奖励提醒（连续 7 天）
* **总结推送**：
  - 每日专注总结（晚上 9 点）
  - 每周总结（周日晚）
  - 每月总结（月末）
* **智能提醒**：
  - 最佳专注时段提醒（基于历史数据）
  - 休息过久提醒（休息超过 30 分钟）
  - 久坐提醒（连续专注 2 小时）

#### 5.2 通知设置
* **通知开关**：
  - 分类开关（专注/提醒/总结/智能）
  - 免打扰时段设置
  - 周末通知独立开关
* **通知样式**：
  - 通知音选择（5 种预设 + 自定义上传）
  - 振动模式选择（iOS）
  - 横幅/提醒样式选择
  - 通知内容预览开关
* **通知优先级**：
  - 重要通知（专注完成）突破免打扰
  - 普通提醒遵循系统设置
  - 低优先级通知静默推送

#### 5.3 系统集成
* **iOS 集成**：
  - 使用 Local Notifications 本地通知
  - Live Activity 锁屏显示倒计时
  - Widget 快捷启动专注
  - 快捷指令支持（Siri 启动专注）
* **macOS 集成**：
  - 通知中心集成
  - 菜单栏提醒
  - Dock 图标角标显示
  - 系统声音集成

---

### 🧠 6. 专注模式强化功能

#### 6.1 专注锁定模式
* **应用屏蔽**：
  - 自定义屏蔽应用列表（社交、游戏、视频等）
  - 屏蔽强度选择：
    - 软锁定：弹窗提醒但允许打开
    - 中锁定：需要输入密码才能打开
    - 硬锁定：完全无法打开直到专注结束
  - 白名单机制（允许特定应用如番茄钟、音乐）
  - 定时解锁（休息时段自动解锁）
* **网站屏蔽**（macOS/浏览器扩展）：
  - 自定义黑名单网站
  - 支持通配符（如 *.youtube.com）
  - 访问时显示专注提醒页面
* **系统级勿扰**：
  - 自动开启系统勿扰模式
  - 仅允许紧急联系人通知
  - 专注结束自动恢复

#### 6.2 环境音系统
* **内置白噪音**：
  - 雨声（小雨/中雨/雷雨）
  - 海浪声
  - 咖啡厅环境音
  - 森林鸟鸣
  - 篝火声
  - 图书馆环境音
  - 打字声
  - 风声
* **音频控制**：
  - 音量独立调节
  - 支持混音（多种声音叠加）
  - 淡入淡出效果
  - 定时关闭（专注结束自动停止)
  - 后台播放支持
* **扩展功能**：
  - 支持导入自定义音频
  - 收藏夹快速切换
  - 定时切换音频（每 30 分钟换一种）
  - 第三方音乐应用集成（Spotify、Apple Music）

#### 6.3 智能提醒与干预
* **切换应用提醒**：
  - 检测到离开应用时弹窗："是否继续专注?"
  - 可选择"暂停专注"或"继续专注"
  - 记录干扰次数到统计数据
* **屏幕模糊提示**：
  - 切换应用时屏幕短暂模糊 + 文字提醒
  - 模糊强度可调
  - 可设置豁免应用
* **深度专注模式**：
  - 启用后锁定手机/电脑所有功能
  - 仅保留紧急呼叫功能
  - 需要物理按钮组合键才能退出

---

### 🏆 7. 成就与激励系统

#### 7.1 成就徽章体系
* **时长成就**：
  - 新手：累计专注 1 小时
  - 入门：累计专注 10 小时
  - 熟练：累计专注 50 小时
  - 专家：累计专注 100 小时
  - 大师：累计专注 500 小时
  - 传奇：累计专注 1000 小时
* **连续成就**：
  - 破冰：连续专注 1 天
  - 小试牛刀:连续专注 3 天
  - 渐入佳境：连续专注 7 天
  - 坚持不懈：连续专注 30 天
  - 年度坚守：连续专注 365 天
* **番茄成就**：
  - 番茄新人：完成 10 个番茄
  - 番茄达人：完成 100 个番茄
  - 番茄大师：完成 1000 个番茄
  - 完美番茄：连续完成 10 个番茄无中断
* **特殊成就**：
  - 深夜学者：在 23:00-05:00 专注超过 100 小时
  - 早起鸟：在 05:00-07:00 专注超过 50 小时
  - 周末战士：周末专注超过工作日
  - 马拉松：单次专注超过 3 小时
  - 全勤：一个月内每天都有专注记录

#### 7.2 等级系统
* **经验值获取**：
  - 每专注 1 分钟获得 1 经验
  - 完成番茄额外获得 10 经验
  - 连续专注奖励 1.5 倍经验
  - 完成每日目标额外 50 经验
* **等级划分**：
  - Lv1-10：初学者（0-1000 EXP）
  - Lv11-20：进阶者（1000-5000 EXP）
  - Lv21-30：专注者（5000-20000 EXP）
  - Lv31-50：大师（20000-100000 EXP）
  - Lv51+：传奇（100000+ EXP，无上限）
* **等级特权**：
  - 解锁更多主题皮肤
  - 解锁更多环境音
  - 解锁高级统计图表
  - 优先获得新功能体验

#### 7.3 每周/每月总结报告
* **自动生成时间**：
  - 周报：每周日 20:00 生成
  - 月报：每月最后一天 20:00 生成
* **报告内容**：
  - 标题页（"你的本周/本月专注报告"）
  - 核心数据卡片（总时长、排名、对比）
  - 可视化图表（趋势图、分布图）
  - 成就达成列表
  - 励志寄语与下期目标建议
* **报告形式**：
  - 应用内 H5 页面
  - 可生成长图分享
  - 可导出 PDF
  - 推送通知提醒查看

#### 7.4 激励语句系统
* **内置语句库**（200+ 条）：
  - 专注类："专注是通往卓越的唯一道路"
  - 坚持类："每一次专注都是对未来的投资"
  - 鼓励类："你今天又进步了一点"
  - 名人名言："天才就是长期的专注"
* **语句展示位置**：
  - 启动页随机显示
  - 专注完成后显示
  - 每日推送通知
  - 统计页面底部
* **自定义功能**：
  - 用户可添加自己的励志语句
  - 可导入语句库文件
  - 可分享语句给其他用户

#### 7.5 社交激励（可选）
* **排行榜**（仅限好友）：
  - 周专注时长榜
  - 月累计时长榜
  - 连续天数榜
* **好友系统**：
  - 添加好友查看彼此专注数据
  - 相互点赞鼓励
  - 发送专注邀请（一起专注）
* **专注房间**（虚拟共同专注）：
  - 创建或加入房间
  - 实时显示房间内成员专注状态
  - 房间倒计时同步
  - 完成后集体庆祝

---

### 🧰 8. 任务与计划系统

#### 8.1 任务管理
* **任务属性**：
  - 任务名称（必填）
  - 任务描述（选填，支持富文本）
  - 目标时长（小时/分钟）
  - 优先级（高/中/低）
  - 截止日期（选填）
  - 关联标签（多选）
  - 颜色标记（12 色可选）
  - 任务图标（50+ 图标库）
* **任务操作**：
  - 新建任务
  - 编辑任务
  - 删除任务（二次确认）
  - 归档任务（完成后归档）
  - 任务排序（拖拽或按优先级/截止日期）
  - 批量操作（批量归档/删除）

#### 8.2 任务视图
* **列表视图**：
  - 紧凑列表显示所有任务
  - 显示任务名、进度条、剩余时长
  - 支持折叠/展开详情
  - 侧滑操作（快速开始专注/编辑/删除）
* **看板视图**：
  - 未开始 / 进行中 / 已完成 三栏
  - 卡片式展示任务
  - 拖拽切换状态
* **日历视图**：
  - 按截止日期显示任务
  - 点击日期查看当日任务
  - 过期任务红色标注
* **甘特图视图**（进阶功能）：
  - 时间轴展示任务计划
  - 显示任务依赖关系
  - 可调整任务时间段

#### 8.3 任务与专注关联
* **关联机制**：
  - 开始专注时选择关联任务
  - 专注时长自动计入任务进度
  - 任务详情页显示所有关联专注记录
* **进度追踪**：
  - 进度条实时更新
  - 进度百分比显示
  - 预计完成时间（基于平均速度）
  - 超时警告（超过目标时长）
* **任务完成**：
  - 达到目标时长自动完成（可选）
  - 手动标记完成
  - 完成动画与音效
  - 完成后归档到"已完成"列表

#### 8.4 项目管理（进阶）
* **项目结构**：
  - 项目可包含多个子任务
  - 支持三级树形结构
  - 项目整体进度自动计算
* **项目模板**：
  - 预设模板（考试准备、技能学习、项目开发等）
  - 自定义模板保存
  - 一键应用模板创建项目
* **项目统计**：
  - 项目总耗时
  - 子任务完成率
  - 项目时间轴甘特图
  - 导出项目报告

### 7.4 性能优化策略

#### 内存优化
- **图片缓存管理**：使用 AsyncImage 配合 URLCache
- **列表懒加载**：大列表使用 LazyVStack/LazyHStack
- **及时释放资源**：使用 onDisappear 清理定时器、音频播放器
- **SwiftData 批量操作**：使用 ModelContext 的批量插入和更新

#### 渲染优化
- **避免过度重建**：合理使用 @State、@Binding、@ObservedObject
- **视图拆分**：将复杂视图拆分为子视图
- **drawingGroup()**：对复杂动画使用 Metal 渲染
- **TimelineView**：优化动画性能，只在需要时更新

#### 数据同步优化
- **批量同步**：累积多条记录后批量上传到 CloudKit
- **差异同步**：使用 CloudKit 的 CKRecordZone 变更追踪
- **自动重试**：网络中断后使用指数退避算法重试
- **后台同步**：使用 BackgroundTasks framework 实现后台同步


**本需求文档为详尽版本，包含所有核心功能、扩展功能、技术细节和 UI 设计规范，可直接用于指导开发团队进行产品实现。建议根据实际资源和时间调整开发优先级，优先完成 MVP 核心功能，再逐步迭代高级功能。**